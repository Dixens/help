---

template:         article
reviewed:         2016-07-11
title:            Install Drupal 8
naviTitle:        Drupal
lead:             Drupal is one of the best known open source PHP CMS. Learn here how to use it with fortrabbit.


websiteLink:      https://www.drupal.org/?utm_source=fortrabbit
websiteLinkText:  drupal.org
category:         CMS
image:            drupal8-mark.png
version:          8.1 (dev)

seeAlsoLinks:
    - app

keywords:
    - drupal
    - install

tags:
    - beginner
    - php
    - install

---

## Install

We assume you've already created a New App with fortrabbit. You also need a local Composer based [Drupal 8 installation](https://github.com/drupal-composer/drupal-project) installation. You can either use an existing one or initialize a new one.

### New installation

Start out by creating a new Drupal project locally. When asked choose the latest "8.0.x" version, 8.0.5 as of the writing of this article:

```bash
$ composer create-project drupal-composer/drupal-project:8.x-dev --stability dev --no-interaction MyApp
$ cd MyApp
```

Once that is done, visit your local installation in the browser and proceed with the installation wizard. Once that is also done you can continue with "Existing installation" below.

### Existing installation

Create a new file `web/sites/default/settings_prod.php` with the following contents:

```php
// environment detection: Only run on fortrabbit
if (!isset($_SERVER['APP_SECRETS'])) {
    return;
}

$secrets = json_decode(file_get_contents($_SERVER['APP_SECRETS']), true);
$databases['default']['default'] = [
    'database'  => $secrets['MYSQL']['DATABASE'],
    'username'  => $secrets['MYSQL']['USER'],
    'password'  => $secrets['MYSQL']['PASSWORD'],
    'prefix'    => '',
    'host'      => $secrets['MYSQL']['HOST'],
    'port'      => $secrets['MYSQL']['PORT'],
    'namespace' => 'Drupal\\Core\\Database\\Driver\\mysql',
    'driver'    => 'mysql',
];
```

Now open up `web/sites/default/settings.php`. At the bottom of the file include the just created production file:

```php
// ..

include __DIR__ . '/settings_prod.php';
```

Next create the file `fortrabbit.yml` to make sure that the `web/core` folder, which contains the Drupal core itself, and the `web/modules/config` folder, which contains later installed modules.

```yaml
sustained:
    - vendor
    - web/core
    - web/modules/contrib
```

Next up is installing and enabling the Flysystem modules:

```bash
# install
$ composer require drupal/flysystem dev-8.x-1.x
$ composer require drupal/flysystem_s3 dev-8.x-1.x

# enable (drupal console must be called from the `web/` sub folder)
$ cd web
$ php ../vendor/bin/drupal module:install flysystem
$ php ../vendor/bin/drupal module:install flysystem_s3
```

Now you need to configure the [Object Storage](/object-storage), which will contain all user generated files. Open up `web/sites/default/settings_prod.php` again and add at the bottom:

``` php
$schemes = [
    'object-storage' => [
        'driver' => 's3',
        'config' => [
            'key'      => $secrets['OBJECT_STORAGE']['KEY'],
            'secret'   => $secrets['OBJECT_STORAGE']['SECRET'],
            'region'   => $secrets['OBJECT_STORAGE']['REGION'],
            'bucket'   => $secrets['OBJECT_STORAGE']['BUCKET'],
            'options'  => [],
            'protocol' => 'https',
            'prefix'   => '',
            'cname'    => $secrets['OBJECT_STORAGE']['HOST'],
        ],
        'cache' => false,
    ],
];

$settings['flysystem'] = $schemes;
```

#### Copy local database

Now is a good time to export your local database and import it into your App. Before issuing the following commands you need to open up a [Tunnel to your App's database](/mysql#toc-shell-tunnel-mysql):

```bash
# Fetch your fortrabbit database credentials
$ ssh {{ssh-user}}@deploy.{{region}}.frbit.com secrets MYSQL

# export local database
$ mysqldump -u<your-local-user> -p <your-local-db> > drupal.sql

# import into fortrabbit database
#   you will be prompted for your fortrabbit database password
$ mysql -u{{app-name}} -h127.0.0.1 -P13306 -p {{app-name}} < drupal.sql
```


### Deploy the first time

Before you can push your first deploy you need to create the `.gitignore` file, if it does not already exist, on top level:

```
# Ignore directories generated by Composer
drush/contrib
vendor
web/core
web/modules/contrib
web/themes/contrib
web/profiles/contrib

# Ignore Drupal's file directory
web/sites/*/files

# Ignore local
web/sites/default/settings_flysystem.php

# Ignore files generated by PhpStorm
.idea
```

Now you are done. Just setup Git, add your App's Git remote and push:

```bash
$ git init .
$ git remote add fortrabbit {{ssh-user}}@deploy.{{region}}.frbit.com:{{app-name}}.git
$ git add -A
$ git commit -m 'Initial'
```

While the code is being pushed and Composer is executed head over to the [Dashboard](/dashboard) and go to your App > Domains and set the Root path of your domain(s) to `web`. Once the deployment has finished (takes much longer on the first time as all Composer packages need to be installed) you can visit the App URL in your browser: `https://{{app-name}}.frb.io/`.
